<!DOCTYPE html>
<html lang="ru">
	<link rel="stylesheet" href="style2.css" />
	<header>
		<a href="https://spamigor.site"><h1>Вернуться на основную страницу Толянуса</h1></a>
	</header>
	<div id="content"></div>
	<button id="ssss">sssss</button>

	<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

	<script type="text/babel">
		let root=ReactDOM.createRoot(document.getElementById("content"));
		document.getElementById('ssss').onclick = function() {
			console.log('hello');
			listData.check.push(false);
			listData.name.push('aaa');
			listData.total.push(3);
			listData.posTotal+=1;
			root.render(<Table />);
			console.log('list data 1');
			console.log(listData);
		}
        /*let socket = new WebSocket("wss://spamigor.site:8080", 'echo-protocol');
		socket.onopen = function(e) {
			console.log('Соккет открыт');
			//socket.send('li: hello');
		};
		socket.onclose = function(e) {
			console.log('соккет закрыт')
		};
		socket.onmessage = function(event) {
			console.log(event.data);
        };*/

        let listData = {
			check: [false, false],
			name: ['Название', 'арбуз'],
			total: [0,1],
			posTotal: 1,
			valBuf: 0
		};
		class Table extends React.Component {
			constructor(props) {
				super(props);
				this.state = listData;
			}
			handleName(event) {
				this.setState({value: event.target.value});
			}
			handleTotal(event) {
				let trig = Number(event.target.value) ? true : false;
				if (trig)
				{
					this.state.value2 = event.target.value;
					this.state.valBuf = event.target.value;
					this.setState(this.state);
				}
				else {
					let a = this.state.valBuf;
					if (a>0) this.setState({value2: a});
					else this.setState({value2: ''});
				}
			}
			handleCheck(event) {
				this.setState({value3: event.target.value});
			}

			handleSubmit(event) {
				this.state.check.push(false);
				this.state.name.push(this.state.value);
				this.state.total.push(Number(this.state.value2));
				this.state.value = '';
				this.state.value2 = '';
				this.state.value3 = false;
				this.state.valBuf = 0;
				listData.posTotal+=1;
				this.state.posTotal = listData.posTotal;
				this.setState(this.state);
                //socket.send('add Data');
				event.preventDefault(); //отменяем отправку формы
			}
			handleChange(event) {
				this.state.check.splice(event.target.value, 1);
				this.state.name.splice(event.target.value, 1);
				this.state.total.splice(event.target.value, 1);
				listData.posTotal-=1;
				this.state.posTotal = listData.posTotal;
                //socket.send('del Data');
				this.setState(this.state);
			}

			handleCheck(event) {
				this.state.check[event.target.value]=!this.state.check[event.target.value];
				this.setState(this.state);
                //socket.send('check Data');
			}

			render() {
				let arr = [], arrName;
				for (let i=1; i<this.state.posTotal+1; i++) {
					let a = (this.state.check[i] ? 'line' : 'noLine');
					arr.push(
						<tr key={i}  id="tesst">
							<td className="tdList"><input className="listBox" id="checkbox" type="checkbox" value={i} 
								checked={this.state.check[i]} onChange={this.handleCheck.bind(this)} />
							<p className="listBox" id={a}>{this.state.name[i]}</p></td>
							<td className="tdList" id="tdList2"><p className="listBox">{this.state.total[i]} шт.</p>
							<button className="listBox" value={i} onClick={this.handleChange.bind(this)}>Удалить</button></td>
						</tr>
				)};
				arr.length>0 ? arrName=<h3>Список покупок</h3> : arrName=<h3>Список пуст</h3>
				return <div id="ddiv">
					<table id="list">
						{arrName}
						{arr}
					</table>
					<form onSubmit={this.handleSubmit.bind(this)} id="formPut">
						<h2>Добавить в список</h2>
						<div id="seckondLine">
							<div className="formDiv" id="nameInp">
								<p className="formLable">{this.state.name[0]}</p>
								<input className="formInp" value={this.state.value} onChange={this.handleName.bind(this)} required />
							</div>
							<div className="formDiv" id="totalInp">
								<p className="formLable">Количество</p>
								<input className="formInp" value={this.state.value2} onChange={this.handleTotal.bind(this)} required />
							</div>
							<input className="button" type="submit" />
						</div>
					</form>
				</div>
			}
		}
		ReactDOM.render(
					<Table />,
					document.getElementById('content')
				)
	</script>
</html>